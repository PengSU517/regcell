---
title: "test"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{test}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(regcell)
```




```{r}
###need to set original values better
{
  n = 100
  e = 0.05
  p = 10
  pr = 5
  df = 3
  r = 0
  gamma = 10
  beta = c(1,1,1,1,1)
  
}
```

```{r}

data = srlmcell::genevar(n = n, e = e, p = p, pr = pr, df = df,r = r, gamma = gamma, beta = beta,outtype = "cellwise")
ximp <- suppressMessages(cellWise::DDC(data$x)$Ximp)
x = data$x
y = data$y
beta = data$beta
beta
```

```{r}
fit1 = sregcell(y = y, x = x, adadelta = T,adabeta = T,alpha = 0.9)
fit2 = sregcell(y = y, x = x, adadelta = T,adabeta = F,alpha = 0.9)
fit3 = sregcell(y = y, x = x, adadelta = F,adabeta = T,alpha = 0.9)
fit4 = sregcell(y = y, x = x, adadelta = F,adabeta = F,alpha = 0.9)
```
```{r}
fit21 = sregcell(y = y, x = x, adadelta = T,adabeta = T,alpha = 0.5)
fit22 = sregcell(y = y, x = x, adadelta = T,adabeta = F,alpha = 0.5)
fit23 = sregcell(y = y, x = x, adadelta = F,adabeta = T,alpha = 0.5)
fit24 = sregcell(y = y, x = x, adadelta = F,adabeta = F,alpha = 0.5)
```

```{r}
cbind(fit1$betahat,fit2$betahat,fit3$betahat,fit4$betahat,fit21$betahat,fit22$betahat,fit23$betahat,fit24$betahat)

cbind(fit1$loss,fit2$loss,fit3$loss,fit4$loss,fit21$loss,fit22$loss,fit23$loss,fit24$loss)
```


```{r}
betahat = regcell::soft_threshold_beta(betahat = beta+p:1/100, alambda_beta = rep(0.05,p))
#betahat

deltahat = regcell::soft_threshold_delta(deltahat = x, alambda_delta = matrix(1,n,p))
#deltahat
```


```{r}
fit_delta = reg_delta(y,x,betahat = beta,deltahat = deltahat,lambda_delta = 3)
(fit_delta$deltahat!=0 )- data$outlierlabel

```

```{r}
reg_beta(y = y,x = x - fit_delta$deltahat,betahat = beta, alpha = 0,lambda_beta = 10)
```


```{r}
reg_beta_delta(y,x,betahat = betahat,alpha = 0,deltahat = deltahat,lambda_beta = 10*log(n),lambda_delta = 3)
```





